ALTER TABLE tblsubject
ADD UNIQUE KEY unique_subjectname_teacher (subjectname,Â teacher);


INSERT INTO `tblusers` (`gender`, `surname`, `forename`, `password`, `house`, `year`, `role`) VALUES
('M', 'Blackburn', 'Zebedee', 'verysecure!', 'Sidney', 12, 0),

INSERT INTO `tblsubject` (`subjectname`, `teacher`) VALUES
('Computer Science', 'Mr Cunniffe'),




<?php
echo("<input type='hidden' name='subjectid' value='" .$row["subjectid"]. "'>");
?>


// This function is triggered when the user selects a pupil from the dropdown
function fetchSubjects() {
    // Get the ID of the selected pupil
    var pupilId = document.getElementById("student").value;

    // Check if a pupil has been selected
    if (pupilId != "") {
        // Create a new XMLHttpRequest object to handle the POST request
        var xhr = new XMLHttpRequest();

        // Open a POST request to the 'get_subjects.php' script
        xhr.open("POST", "get_subjects.php", true);

        // Set the Content-Type header to send data as form data (URL encoded)
        xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");

        // Define what happens when the request completes
        xhr.onload = function() {
            // If the request is successful, insert the returned data into the page
            if (xhr.status == 200) {
                // Insert the HTML for the subject dropdown into the 'subject_select' div
                document.getElementById("subject_select").innerHTML = xhr.responseText;
            } else {
                console.error("Error in AJAX request:", xhr.status, xhr.statusText);
            }
        };

        // Handle potential errors
        xhr.onerror = function() {
            console.error("Request failed");
        };

        // Send the POST request with the pupil ID in the request body
        xhr.send("student=" + pupilId);
    } else {
        // If no pupil is selected, clear the subject selection area
        document.getElementById("subject_select").innerHTML = "";
    }
}


<?php
// Check if the 'student' parameter is set in the POST request
if (isset($_POST['student'])) {
    // Retrieve the selected pupil's ID from the POST request
    $selectedUserId = $_POST['student'];

    // Include the database connection
    include_once("connection.php");

    // Prepare the SQL query to fetch the subjects for the selected pupil
    $stmt = $conn->prepare("SELECT ts.subjectname, ts.subjectid 
                            FROM tblsubject AS ts 
                            INNER JOIN tblpupilstudies AS tps 
                            ON ts.subjectid = tps.subjectid 
                            WHERE tps.userid = :selecteduserid");

    // Bind the pupil ID to the query parameter
    $stmt->bindParam(':selecteduserid', $selectedUserId);

    // Execute the query
    $stmt->execute();

    // Generate the HTML for the subject dropdown
    echo '<label for="subjectid">Select Subject:</label>';
    echo '<select name="subjectid" required>';
    echo '<option value="">--Select Subject--</option>';

    // Fetch the subjects and populate the dropdown options
    while ($row = $stmt->fetch(PDO::FETCH_ASSOC)) {
        echo '<option value="' . $row['subjectid'] . '">' . $row['subjectname'] . '</option>';
    }

    echo '</select>';
}
?>



<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Select Subject</title>
    </head>
    <body>
        <h1>Select a Subject for the Pupil</h1>
        <form method="POST" action="insert_pupil_study.php">
            Subject:
            <select name="subjectid">
                <?php
                    array_map("htmlspecialchars", $_POST);
                    //print_r($_POST);
                    include_once("connection.php");
                    $stmt = $conn->prepare("SELECT tu.forename,ts.subjectname,ts.subjectid FROM tblusers AS tu INNER JOIN tblpupilstudies AS tps ON tu.userid = tps.userid INNER JOIN tblsubject AS ts ON tps.subjectid = ts.subjectid WHERE tu.userid = :selecteduserid;");
                    $stmt->bindParam(':selecteduserid', $_POST["student"]);
                    $stmt->execute();
                    while ($row = $stmt->fetch(PDO::FETCH_ASSOC))
                        {
                            //print_r($row);
                            //echo($row["forename"]." ".$row["subjectname"]."<br>");
                            echo("<option value=".$row["subjectid"].">".$row["subjectname"]."</option>");
                        }
                ?>
            </select>
            <?php
                echo("<input type='hidden' name='userid' value='" .$_POST['student']. "'>");
            ?>
            <br>
            Class Position:<input type="number" name="classposition" min="1">
            <br>
            Grade:<input type="radio" name="grade" value="A*" checked> A&#42;
            <input type="radio" name="grade" value="A" checked> A
            <input type="radio" name="grade" value="B" checked> B
            <input type="radio" name="grade" value="C" checked> C
            <input type="radio" name="grade" value="D" checked> D
            <input type="radio" name="grade" value="F" checked> F
            <input type="radio" name="grade" value="U" checked> U
            <br>
            Exam Mark:<input type="number" name="exammark" min="0">
            <br>
            Comment:<br><textarea name="comment" rows="6" cols="75"></textarea>
            <br>
            <input type="submit">
        </form>
    </body>
</html>